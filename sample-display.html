<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>样片展示 - 无人机自助打卡</title>
    <link href="assets/css/tailwind-custom.css" rel="stylesheet">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/inter-font.css" rel="stylesheet">
    <style>
        .selected-sample {
            border: 2px solid #3B82F6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body class="font-inter bg-light text-dark antialiased touch-action-manipulation">
    <div class="min-h-screen w-full pb-16 safe-area-bottom">
        <!-- 顶部导航栏 -->
        <header class="sticky top-0 left-0 right-0 bg-white z-30 border-b border-gray-light">
            <div class="container mx-auto px-4 py-3 flex justify-center items-center">
                <h1 class="font-bold text-dark">样片展示</h1>
            </div>
        </header>

        <!-- 分类筛选 -->
        <div class="sticky top-12 left-0 right-0 bg-white z-20 px-4 py-3 border-b border-gray-light">
            <div class="flex space-x-2 overflow-x-auto pb-1 scrollbar-hide">
                <button class="filter-btn flex-shrink-0 px-4 py-2 bg-primary text-white rounded-full text-sm font-medium whitespace-nowrap touch-friendly" data-filter="all">
                    <i class="fa fa-th-large mr-1"></i>全部
                </button>
                <button class="filter-btn flex-shrink-0 px-4 py-2 bg-gray-100 text-dark rounded-full text-sm font-medium whitespace-nowrap touch-friendly" data-filter="temple">
                    <i class="fa fa-home mr-1"></i>古寺名刹
                </button>
                <button class="filter-btn flex-shrink-0 px-4 py-2 bg-gray-100 text-dark rounded-full text-sm font-medium whitespace-nowrap touch-friendly" data-filter="peak">
                    <i class="fa fa-flag mr-1"></i>山峰奇景
                </button>
                <button class="filter-btn flex-shrink-0 px-4 py-2 bg-gray-100 text-dark rounded-full text-sm font-medium whitespace-nowrap touch-friendly" data-filter="cave">
                    <i class="fa fa-circle-o mr-1"></i>洞穴仙境
                </button>
                <button class="filter-btn flex-shrink-0 px-4 py-2 bg-gray-100 text-dark rounded-full text-sm font-medium whitespace-nowrap touch-friendly" data-filter="heritage">
                    <i class="fa fa-bookmark mr-1"></i>文化遗迹
                </button>
            </div>
        </div>

        <!-- 样片网格 -->
        <div class="px-4 py-4 miniprogram-scroll">
            <div class="grid grid-cols-2 gap-3">
                <!-- 涌泉寺样片 -->
                <div class="gallery-item miniprogram-card overflow-hidden touch-friendly" data-category="temple" onclick="openModal('涌泉寺全景', '千年古刹，佛教圣地，展现古建筑的庄严与宁静', 'assets/images/mountain-1015.jpg', 'video', 'temple')">
                    <div class="relative">
                        <img src="assets/images/mountain-1015.jpg" alt="涌泉寺全景" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center">
                                <i class="fa fa-play text-white"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <div class="text-white text-xs font-medium">3:20</div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm mb-1">涌泉寺全景</h4>
                        <p class="text-gray-medium text-xs mb-2">千年古刹，佛教圣地</p>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-primary">
                                <i class="fa fa-star mr-1"></i> 4.9
                            </div>
                            <div class="text-xs text-gray-medium">¥128</div>
                        </div>
                    </div>
                </div>
                
                <!-- 摩崖石刻样片 -->
                <div class="gallery-item miniprogram-card overflow-hidden touch-friendly" data-category="heritage" onclick="openModal('摩崖石刻航拍', '历史文化遗迹，石刻艺术精品，记录千年文明', 'assets/images/city-1016.jpg', 'video', 'heritage')">
                    <div class="relative">
                        <img src="assets/images/city-1016.jpg" alt="摩崖石刻航拍" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center">
                                <i class="fa fa-play text-white"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <div class="text-white text-xs font-medium">2:45</div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm mb-1">摩崖石刻航拍</h4>
                        <p class="text-gray-medium text-xs mb-2">历史文化遗迹</p>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-primary">
                                <i class="fa fa-star mr-1"></i> 4.8
                            </div>
                            <div class="text-xs text-gray-medium">¥118</div>
                        </div>
                    </div>
                </div>
                
                <!-- 登山古径样片 -->
                <div class="gallery-item miniprogram-card overflow-hidden touch-friendly" data-category="heritage" onclick="openModal('登山古径跟拍', '古道悠悠，历史足迹，展现朝圣者的虔诚之路', 'assets/images/forest-1020.jpg', 'video', 'heritage')">
                    <div class="relative">
                        <img src="assets/images/forest-1020.jpg" alt="登山古径跟拍" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center">
                                <i class="fa fa-play text-white"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <div class="text-white text-xs font-medium">4:10</div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm mb-1">登山古径跟拍</h4>
                        <p class="text-gray-medium text-xs mb-2">古道悠悠，朝圣之路</p>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-primary">
                                <i class="fa fa-star mr-1"></i> 4.7
                            </div>
                            <div class="text-xs text-gray-medium">¥108</div>
                        </div>
                    </div>
                </div>
                
                <!-- 屴崱峰样片 -->
                <div class="gallery-item miniprogram-card overflow-hidden touch-friendly" data-category="peak" onclick="openModal('屴崱峰俯瞰', '天台山主峰，壮丽山景，360度环绕拍摄展现雄伟气势', 'assets/images/mountain-1015.jpg', 'video', 'peak')">
                    <div class="relative">
                        <img src="assets/images/mountain-1015.jpg" alt="屴崱峰俯瞰" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center">
                                <i class="fa fa-play text-white"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <div class="text-white text-xs font-medium">3:50</div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm mb-1">屴崱峰俯瞰</h4>
                        <p class="text-gray-medium text-xs mb-2">天台山主峰，壮丽山景</p>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-primary">
                                <i class="fa fa-star mr-1"></i> 4.9
                            </div>
                            <div class="text-xs text-gray-medium">¥148</div>
                        </div>
                    </div>
                        </div>
                
                <!-- 回龙阁样片 -->
                <div class="gallery-item miniprogram-card overflow-hidden touch-friendly" data-category="heritage" onclick="openModal('回龙阁建筑拍摄', '古典楼阁，建筑瑰宝，展现传统建筑的精美工艺', 'assets/images/city-1016.jpg', 'video', 'heritage')">
                    <div class="relative">
                        <img src="assets/images/city-1016.jpg" alt="回龙阁建筑拍摄" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center">
                                <i class="fa fa-play text-white"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <div class="text-white text-xs font-medium">2:30</div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm mb-1">回龙阁建筑拍摄</h4>
                        <p class="text-gray-medium text-xs mb-2">古典楼阁，建筑瑰宝</p>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-primary">
                                <i class="fa fa-star mr-1"></i> 4.8
                            </div>
                            <div class="text-xs text-gray-medium">¥98</div>
                        </div>
                    </div>
                </div>
                
                <!-- 灵源洞样片 -->
                <div class="gallery-item miniprogram-card overflow-hidden touch-friendly" data-category="cave" onclick="openModal('灵源洞探秘', '神秘洞穴，自然造化，展现地下世界的奇妙景观', 'assets/images/lake-1031.jpg', 'video', 'cave')">
                    <div class="relative">
                        <img src="assets/images/lake-1031.jpg" alt="灵源洞探秘" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center">
                                <i class="fa fa-play text-white"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <div class="text-white text-xs font-medium">3:15</div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm mb-1">灵源洞探秘</h4>
                        <p class="text-gray-medium text-xs mb-2">神秘洞穴，自然造化</p>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-primary">
                                <i class="fa fa-star mr-1"></i> 4.7
                            </div>
                            <div class="text-xs text-gray-medium">¥128</div>
                        </div>
                    </div>
                </div>
                
                <!-- 罗汉台样片 -->
                <div class="gallery-item miniprogram-card overflow-hidden touch-friendly" data-category="temple" onclick="openModal('罗汉台禅境', '佛教圣地，庄严肃穆，展现禅修文化的深邃意境', 'assets/images/mountain-1015.jpg', 'video', 'temple')">
                    <div class="relative">
                        <img src="assets/images/mountain-1015.jpg" alt="罗汉台禅境" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center">
                                <i class="fa fa-play text-white"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <div class="text-white text-xs font-medium">2:55</div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm mb-1">罗汉台禅境</h4>
                        <p class="text-gray-medium text-xs mb-2">佛教圣地，庄严肃穆</p>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-primary">
                                <i class="fa fa-star mr-1"></i> 4.8
                            </div>
                            <div class="text-xs text-gray-medium">¥118</div>
                        </div>
                    </div>
                </div>
                
                <!-- 香炉峰样片 -->
                <div class="gallery-item miniprogram-card overflow-hidden touch-friendly" data-category="peak" onclick="openModal('香炉峰日出', '山峰奇景，日出壮观，捕捉第一缕阳光的绚烂时刻', 'assets/images/mountain-1015.jpg', 'video', 'peak')">
                    <div class="relative">
                        <img src="assets/images/mountain-1015.jpg" alt="香炉峰日出" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center">
                                <i class="fa fa-play text-white"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <div class="text-white text-xs font-medium">4:25</div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm mb-1">香炉峰日出</h4>
                        <p class="text-gray-medium text-xs mb-2">山峰奇景，日出壮观</p>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-primary">
                                <i class="fa fa-star mr-1"></i> 4.9
                            </div>
                            <div class="text-xs text-gray-medium">¥158</div>
                        </div>
                    </div>
                </div>
                
                <!-- 白云洞样片 -->
                <div class="gallery-item miniprogram-card overflow-hidden touch-friendly" data-category="cave" onclick="openModal('白云洞仙境', '云雾缭绕，仙境般美景，展现天台山的神秘魅力', 'assets/images/lake-1031.jpg', 'video', 'cave')">
                    <div class="relative">
                        <img src="assets/images/lake-1031.jpg" alt="白云洞仙境" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-10 h-10 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center">
                                <i class="fa fa-play text-white"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2">
                            <div class="text-white text-xs font-medium">3:40</div>
                        </div>
                    </div>
                    <div class="p-3">
                        <h4 class="font-medium text-sm mb-1">白云洞仙境</h4>
                        <p class="text-gray-medium text-xs mb-2">云雾缭绕，仙境般美景</p>
                        <div class="flex justify-between items-center">
                            <div class="text-xs text-primary">
                                <i class="fa fa-star mr-1"></i> 4.8
                            </div>
                            <div class="text-xs text-gray-medium">¥138</div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- 加载更多 -->
            <div class="text-center py-8 mb-16">
                <button id="load-more" class="px-6 py-3 bg-white miniprogram-card text-gray-medium font-medium touch-friendly">
                    <i class="fa fa-refresh mr-2"></i>加载更多样片
                </button>
            </div>
        </div>
    </div>

    <!-- 样片详情模态框 -->
    <div id="gallery-detail-modal" class="fixed inset-0 bg-black/90 z-50 hidden flex items-center justify-center">
        <button id="close-gallery-detail" class="fixed top-8 right-4 text-white p-2 z-10 touch-friendly">
            <i class="fa fa-times text-xl"></i>
        </button>
        <div class="w-full max-w-sm mx-4">
            <div class="relative mb-4 rounded-lg overflow-hidden">
                <img id="gallery-detail-img" src="" alt="样片详情" class="w-full h-64 object-cover">
                <div id="play-overlay" class="absolute inset-0 flex items-center justify-center">
                    <div class="w-16 h-16 rounded-full bg-accent/80 flex items-center justify-center">
                        <i class="fa fa-play text-white text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <h2 id="gallery-detail-title" class="text-white text-lg font-bold mb-2">样片标题</h2>
                <p id="gallery-detail-desc" class="text-white/80 text-sm mb-4">样片描述</p>
                <div class="flex justify-center space-x-4 mb-4">
                    <div class="text-white text-sm">
                        <i class="fa fa-star mr-1"></i> <span id="detail-rating">4.9</span>
                    </div>
                </div>
                
                <!-- 分享和点赞按钮 -->
                <div class="flex justify-center space-x-4 mb-4">
                    <button id="like-btn" onclick="toggleLike()" class="flex items-center px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors touch-friendly">
                        <i id="like-icon" class="fa fa-star-o mr-2"></i>
                        <span id="like-text">点赞</span>
                    </button>
                    <button onclick="shareVideo()" class="flex items-center px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors touch-friendly">
                        <i class="fa fa-share-alt mr-2"></i>分享
                    </button>
                </div>
                
                <button id="shooting-btn" onclick="toggleSampleSelection()" class="w-full py-3 bg-primary text-white rounded-lg font-medium touch-friendly">
                    <i id="shooting-icon" class="fa fa-rocket mr-2"></i><span id="shooting-text">选择此效果拍摄</span>
                </button>
            </div>
        </div>
    </div>

    <!-- 微信小程序底部导航栏 -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-light z-50 safe-area-bottom" id="bottomNav">
        <div class="flex justify-around items-center h-16">
            <div class="tab-item flex flex-col items-center justify-center text-gray-medium touch-friendly" onclick="location.href='index.html'">
                <i class="fa fa-home text-lg mb-1"></i>
                <span class="text-xs">首页</span>
            </div>
            <div class="tab-item flex flex-col items-center justify-center text-primary touch-friendly active">
                <i class="fa fa-picture-o text-lg mb-1"></i>
                <span class="text-xs">样片</span>
            </div>
            <div class="tab-item flex flex-col items-center justify-center touch-friendly" onclick="location.href='user-selection.html'">
                <div class="w-12 h-12 rounded-full bg-primary text-white flex items-center justify-center -mt-6 shadow-lg relative">
                    <i class="fa fa-camera text-lg"></i>
                </div>
                <span class="text-xs text-gray-medium font-medium mt-1">拍摄</span>
            </div>
            <div class="tab-item flex flex-col items-center justify-center text-gray-medium touch-friendly" onclick="checkLoginAndGoToOrders()">
                <i class="fa fa-list-alt text-lg mb-1"></i>
                <span class="text-xs">订单</span>
            </div>
            <div class="tab-item flex flex-col items-center justify-center text-gray-medium touch-friendly" onclick="location.href='my-profile.html'">
                <i class="fa fa-user text-lg mb-1"></i>
                <span class="text-xs">我的</span>
            </div>
        </div>
    </nav>





    <!-- JavaScript交互代码 -->
    <script>
        // 小程序样式初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 添加小程序风格的触摸反馈
            const touchElements = document.querySelectorAll('.touch-friendly');
            touchElements.forEach(element => {
                element.addEventListener('touchstart', function() {
                    this.style.opacity = '0.7';
                    this.style.transform = 'scale(0.95)';
                });
                
                element.addEventListener('touchend', function() {
                    this.style.opacity = '1';
                    this.style.transform = 'scale(1)';
                });
                
                element.addEventListener('touchcancel', function() {
                    this.style.opacity = '1';
                    this.style.transform = 'scale(1)';
                });
            });
        });

        // DOM元素获取
        const filterBtns = document.querySelectorAll('.filter-btn');
        const galleryItems = document.querySelectorAll('.gallery-item');
        const galleryDetailModal = document.getElementById('gallery-detail-modal');
        const closeGalleryDetail = document.getElementById('close-gallery-detail');
        const galleryDetailImg = document.getElementById('gallery-detail-img');
        const galleryDetailTitle = document.getElementById('gallery-detail-title');
        const galleryDetailDesc = document.getElementById('gallery-detail-desc');
        const detailType = document.getElementById('detail-type');
        const detailRating = document.getElementById('detail-rating');
        const playOverlay = document.getElementById('play-overlay');
        const loadMore = document.getElementById('load-more');
        
        // 分类筛选功能
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                // 更新按钮状态
                filterBtns.forEach(b => {
                    b.classList.remove('bg-primary', 'text-white');
                    b.classList.add('bg-gray-100', 'text-dark');
                });
                this.classList.remove('bg-gray-100', 'text-dark');
                this.classList.add('bg-primary', 'text-white');
                
                // 筛选样片
                const filter = this.dataset.filter;
                galleryItems.forEach(item => {
                    if (filter === 'all' || item.dataset.category.includes(filter)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                // 小程序触觉反馈
                if (typeof wx !== 'undefined') {
                    wx.vibrateShort({
                        type: 'light'
                    });
                }
            });
        });
        
        // 打开样片详情模态框
        function openModal(title, desc, imgSrc, type, category) {
            galleryDetailTitle.textContent = title;
            galleryDetailDesc.textContent = desc;
            galleryDetailImg.src = imgSrc;
            // 不再显示类型信息
            detailRating.textContent = (Math.random() * 0.5 + 4.5).toFixed(1);
            
            // 存储当前样片的地点类型，用于跳转时传递
            window.currentSampleCategory = category;
            
            galleryDetailModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // 检查当前样片是否已被选中，并更新按钮文本
            const shootingBtn = document.getElementById('shooting-btn');
            const shootingIcon = document.getElementById('shooting-icon');
            const shootingText = document.getElementById('shooting-text');
            
            const selectedSamples = JSON.parse(localStorage.getItem('selectedSamples') || '[]');
            if (selectedSamples.includes(title)) {
                shootingIcon.className = 'fa fa-times mr-2';
                shootingText.textContent = '取消样片选择';
                shootingBtn.dataset.status = 'selected';
            } else {
                shootingIcon.className = 'fa fa-rocket mr-2';
                shootingText.textContent = '选择此效果拍摄';
                shootingBtn.dataset.status = 'unselected';
            }
            
            // 小程序触觉反馈
            if (typeof wx !== 'undefined') {
                wx.vibrateShort({
                    type: 'medium'
                });
            }
        }
        
        // 关闭样片详情
        closeGalleryDetail.addEventListener('click', function() {
            galleryDetailModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        });
        
        // 点击模态框背景关闭
        galleryDetailModal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        });
        
        // 加载更多功能
        loadMore.addEventListener('click', function() {
            this.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>加载中...';
            this.disabled = true;
            
            // 模拟加载更多
            setTimeout(() => {
                this.innerHTML = '<i class="fa fa-refresh mr-2"></i>加载更多样片';
                this.disabled = false;
                
                // 小程序提示
                if (typeof wx !== 'undefined') {
                    wx.showToast({
                        title: '已加载更多样片',
                        icon: 'success',
                        duration: 1500
                    });
                }
            }, 1500);
        });
        
        // 点赞功能
        let isLiked = false;
        function toggleLike() {
            const likeIcon = document.getElementById('like-icon');
            const likeText = document.getElementById('like-text');
            const likeBtn = document.getElementById('like-btn');
            
            isLiked = !isLiked;
            
            if (isLiked) {
                likeIcon.className = 'fa fa-star mr-2';
                likeText.textContent = '已点赞';
                likeBtn.classList.add('bg-yellow-500/20');
                likeBtn.classList.remove('bg-white/10');
                
                // 小程序触觉反馈和提示
                if (typeof wx !== 'undefined') {
                    wx.vibrateShort({
                        type: 'heavy'
                    });
                    wx.showToast({
                        title: '点赞成功',
                        icon: 'success',
                        duration: 1000
                    });
                }
            } else {
                likeIcon.className = 'fa fa-star-o mr-2';
                likeText.textContent = '点赞';
                likeBtn.classList.remove('bg-yellow-500/20');
                likeBtn.classList.add('bg-white/10');
                
                // 小程序触觉反馈
                if (typeof wx !== 'undefined') {
                    wx.vibrateShort({
                        type: 'light'
                    });
                }
            }
        }
        
        // 分享功能
        function shareVideo() {
            const title = document.getElementById('gallery-detail-title').textContent;
            
            // 小程序分享
            if (typeof wx !== 'undefined') {
                wx.showShareMenu({
                    withShareTicket: true,
                    success: function() {
                        wx.showToast({
                            title: '分享成功',
                            icon: 'success',
                            duration: 1500
                        });
                    }
                });
                
                // 触觉反馈
                wx.vibrateShort({
                    type: 'medium'
                });
            } else {
                // 普通浏览器环境的分享功能
                if (navigator.share) {
                    navigator.share({
                        title: title,
                        text: '推荐一个很棒的无人机拍摄样片',
                        url: window.location.href
                    }).then(() => {
                        console.log('分享成功');
                    }).catch((error) => {
                        console.log('分享失败', error);
                        showShareModal();
                    });
                } else {
                    showShareModal();
                }
            }
        }
        
        // 显示分享选项模态框（备用方案）
        function showShareModal() {
            const shareText = `推荐一个很棒的无人机拍摄样片：${document.getElementById('gallery-detail-title').textContent}`;
            
            // 创建临时文本区域并复制链接
            const textArea = document.createElement('textarea');
            textArea.value = shareText + ' ' + window.location.href;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // 显示提示
            alert('链接已复制到剪贴板，可以分享给好友！');
        }

        // 关闭样片详情模态框，返回到样片列表界面，并在选中的样片上添加标记
        function goToShooting() {
            // 关闭模态框
            galleryDetailModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
            
            // 获取当前样片的标题
            const currentSampleTitle = galleryDetailTitle.textContent;
            
            // 遍历所有样片项，找到匹配的样片并添加选中标记
            const galleryItems = document.querySelectorAll('.gallery-item');
            galleryItems.forEach(item => {
                // 检查当前项是否匹配选中的样片
                const itemTitle = item.querySelector('h4').textContent;
                if (itemTitle === currentSampleTitle) {
                    // 添加选中样式
                    item.classList.add('selected-sample');
                    
                    // 添加选中标记
                    const mark = document.createElement('div');
                    mark.className = 'selected-mark absolute top-2 right-2 w-6 h-6 bg-primary rounded-full flex items-center justify-center z-10';
                    mark.innerHTML = '<i class="fa fa-check text-white text-xs"></i>';
                    
                    // 找到图片容器并添加标记
                    const imgContainer = item.querySelector('.relative');
                    // 检查是否已存在标记，避免重复添加
                    if (!item.querySelector('.selected-mark')) {
                        imgContainer.appendChild(mark);
                    }
                }
            });
            
            // 将选中的样片信息保存到localStorage，用于同步到user-selection页面
            const selectedSamples = JSON.parse(localStorage.getItem('selectedSamples') || '[]');
            if (!selectedSamples.includes(currentSampleTitle)) {
                selectedSamples.push(currentSampleTitle);
                localStorage.setItem('selectedSamples', JSON.stringify(selectedSamples));
            }
            
            // 可以添加一个提示，告知用户样片已被选定
            if (typeof wx !== 'undefined') {
                wx.showToast({
                    title: '样片已选定',
                    icon: 'success',
                    duration: 2000
                });
            }
        }
        
        // 取消样片选择
        function cancelSampleSelection() {
            // 关闭模态框
            galleryDetailModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
            
            // 获取当前样片的标题
            const currentSampleTitle = galleryDetailTitle.textContent;
            
            // 遍历所有样片项，找到匹配的样片并移除选中标记
            const galleryItems = document.querySelectorAll('.gallery-item');
            galleryItems.forEach(item => {
                // 检查当前项是否匹配选中的样片
                const itemTitle = item.querySelector('h4').textContent;
                if (itemTitle === currentSampleTitle) {
                    // 移除选中样式
                    item.classList.remove('selected-sample');
                    
                    // 移除选中标记
                    const mark = item.querySelector('.selected-mark');
                    if (mark) {
                        mark.remove();
                    }
                }
            });
            
            // 从localStorage中移除选中的样片信息
            const selectedSamples = JSON.parse(localStorage.getItem('selectedSamples') || '[]');
            const updatedSamples = selectedSamples.filter(sample => sample !== currentSampleTitle);
            localStorage.setItem('selectedSamples', JSON.stringify(updatedSamples));
            
            // 可以添加一个提示，告知用户已取消选择
            if (typeof wx !== 'undefined') {
                wx.showToast({
                    title: '已取消选择',
                    icon: 'success',
                    duration: 2000
                });
            }
        }
        
        // 根据当前状态切换样片选择
        function toggleSampleSelection() {
            const shootingBtn = document.getElementById('shooting-btn');
            if (shootingBtn.dataset.status === 'selected') {
                cancelSampleSelection();
            } else {
                goToShooting();
            }
        }

        // 检查登录状态并跳转到订单页面
        function checkLoginAndGoToOrders() {
            const loginInfo = JSON.parse(localStorage.getItem('loginInfo') || '{}');
            if (!loginInfo.isLoggedIn) {
                // 未登录，设置返回URL并跳转到登录页面
                localStorage.setItem('returnUrl', 'user-management.html');
                location.href = 'login.html';
            } else {
                // 已登录，直接跳转到订单页面
                location.href = 'user-management.html';
            }
        }


    </script>
</body>
</html>
