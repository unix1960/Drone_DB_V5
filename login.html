<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>用户登录 - 无人机自助打卡</title>
    <script src="assets/js/tailwindcss.min.js"></script>
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/inter-font.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1E40AF',
                        accent: '#06B6D4',
                        dark: '#1E293B',
                        light: '#F8FAFC',
                        'gray-medium': '#64748B',
                        'gray-light': '#E2E8F0',
                        'blue-primary': '#3B82F6',
                        'blue-secondary': '#1D4ED8',
                        'green-primary': '#22C55E',
                    },
                    fontFamily: {
                        inter: ['Inter', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }
            .touch-friendly {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            .safe-area-bottom {
                padding-bottom: constant(safe-area-inset-bottom);
                padding-bottom: env(safe-area-inset-bottom);
            }
            .miniprogram-scroll {
                -webkit-overflow-scrolling: touch;
            }
            .miniprogram-card {
                box-shadow: 0 2px 8px rgba(0,0,0,0.06);
                border-radius: 8px;
            }
            .gradient-bg {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
            .btn-hover {
                transition: all 0.2s ease;
            }
            .btn-hover:active {
                transform: scale(0.98);
                opacity: 0.9;
            }
        }
    </style>
</head>
<body class="font-inter bg-light text-dark antialiased touch-action-manipulation">
    <!-- 背景渐变 -->
    <div class="min-h-screen gradient-bg relative overflow-hidden">
        <!-- 装饰元素 -->
        <div class="absolute top-0 left-0 w-full h-full">
            <div class="absolute top-20 right-10 w-32 h-32 bg-white/10 rounded-full blur-xl"></div>
            <div class="absolute bottom-20 left-10 w-40 h-40 bg-white/5 rounded-full blur-2xl"></div>
        </div>
        
        <!-- 头部导航 -->
        <header class="relative z-10 flex items-center justify-between h-14 px-4 pt-8">
            <button onclick="goBack()" class="flex items-center text-white/80 touch-friendly btn-hover">
                <i class="fa fa-angle-left text-xl mr-1"></i>
                <span class="text-sm">返回</span>
            </button>
            <h1 class="font-bold text-white">登录</h1>
            <div class="w-16"></div>
        </header>

        <!-- 登录内容 -->
        <div class="relative z-10 px-6 mt-16">
            <!-- Logo区域 -->
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-user-circle-o text-3xl text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">欢迎使用</h2>
                <p class="text-white/80 text-sm">无人机自助打卡服务</p>
            </div>

            <!-- 登录方式 -->
            <div class="space-y-4 mb-8">
                <!-- 手机号一键登录 -->
                <button id="phoneQuickLogin" onclick="phoneQuickLogin()" class="w-full bg-green-primary text-white py-4 rounded-lg font-medium touch-friendly flex items-center justify-center miniprogram-card btn-hover">
                    <i class="fa fa-mobile text-xl mr-3"></i>
                    <span>手机号一键登录</span>
                </button>

                <!-- 验证码登录 -->
                <button id="codeLoginBtn" onclick="showCodeLogin()" class="w-full bg-white text-dark py-4 rounded-lg font-medium touch-friendly flex items-center justify-center miniprogram-card btn-hover">
                    <i class="fa fa-shield text-xl mr-3"></i>
                    <span>验证码登录</span>
                </button>
            </div>

            <!-- 服务条款 -->
            <div class="text-center">
                <p class="text-white/60 text-xs leading-relaxed">
                    登录即表示您同意
                    <span class="text-white underline">《用户服务协议》</span>
                    和
                    <span class="text-white underline">《隐私政策》</span>
                </p>
            </div>
        </div>
    </div>

    <!-- 验证码登录弹窗 -->
    <div id="codeLoginModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-sm w-full">
            <div class="p-4 border-b border-gray-light">
                <div class="flex items-center justify-between">
                    <h3 class="font-bold text-dark">验证码登录</h3>
                    <button onclick="closeCodeLogin()" class="text-gray-medium text-xl btn-hover">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-dark mb-2">手机号码</label>
                        <input type="tel" id="phoneNumber" class="w-full p-3 border border-gray-light rounded-lg focus:border-primary focus:outline-none" placeholder="请输入手机号码" maxlength="11">
                    </div>
                    <div class="flex space-x-2">
                        <input type="text" id="verifyCode" class="flex-1 p-3 border border-gray-light rounded-lg focus:border-primary focus:outline-none" placeholder="验证码" maxlength="6">
                        <button id="sendCodeBtn" onclick="sendVerifyCode()" class="px-4 py-3 bg-primary text-white rounded-lg text-sm font-medium touch-friendly whitespace-nowrap btn-hover">
                            获取验证码
                        </button>
                    </div>
                    <button onclick="codeLogin()" class="w-full bg-primary text-white py-3 rounded-lg font-medium touch-friendly btn-hover">
                        登录
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript交互代码 -->
    <script>
        let countdownTimer = null;
        let countdownSeconds = 60;

        // 小程序适配
        document.addEventListener('DOMContentLoaded', function() {
            // 添加触摸反馈效果
            const touchElements = document.querySelectorAll('.btn-hover');
            touchElements.forEach(element => {
                element.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.98)';
                    this.style.opacity = '0.9';
                });
                
                element.addEventListener('touchend', function() {
                    this.style.transform = 'scale(1)';
                    this.style.opacity = '1';
                });
                
                element.addEventListener('touchcancel', function() {
                    this.style.transform = 'scale(1)';
                    this.style.opacity = '1';
                });
            });
        });

        // 返回上一页
        function goBack() {
            const returnUrl = localStorage.getItem('returnUrl');
            if (returnUrl) {
                localStorage.removeItem('returnUrl');
                window.location.href = returnUrl;
            } else {
                history.back();
            }
        }

        // 手机号一键登录
        function phoneQuickLogin() {
            // 模拟获取微信手机号（在微信环境中应调用官方API）
            if (typeof wx !== 'undefined') {
                // 调用微信小程序获取手机号API
                wx.getPhoneNumber({
                    success: function(res) {
                        handleQuickLoginSuccess();
                    },
                    fail: function() {
                        showToast('获取手机号失败，请使用验证码登录');
                    }
                });
            } else {
                // 非小程序环境，模拟一键登录
                showToast('正在模拟一键登录...');
                setTimeout(() => {
                    handleQuickLoginSuccess();
                }, 1000);
            }
        }

        // 处理一键登录成功
        function handleQuickLoginSuccess() {
            // 模拟生成用户信息
            const randomPhone = '138****' + Math.floor(Math.random() * 9000 + 1000);
            const userInfo = {
                phone: randomPhone,
                loginType: 'quick',
                timestamp: Date.now()
            };
            
            // 保存登录信息
            const loginInfo = {
                isLoggedIn: true,
                loginTime: new Date().toISOString(),
                ...userInfo
            };
            
            localStorage.setItem('loginInfo', JSON.stringify(loginInfo));
            
            // 保存用户信息
            const userData = {
                phone: userInfo.phone,
                name: '',
                gender: ''
            };
            localStorage.setItem('userInfo', JSON.stringify(userData));
            
            showToast('登录成功');
            setTimeout(() => {
                redirectAfterLogin();
            }, 1000);
        }

        // 显示验证码登录弹窗
        function showCodeLogin() {
            document.getElementById('codeLoginModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // 关闭验证码登录弹窗
        function closeCodeLogin() {
            document.getElementById('codeLoginModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            
            // 清理倒计时
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
                resetSendCodeButton();
            }
        }

        // 发送验证码
        function sendVerifyCode() {
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            
            // 简单格式检查，不做真实性验证
            if (!phoneNumber || phoneNumber.length !== 11) {
                showToast('请输入11位手机号码');
                return;
            }

            // 开始倒计时
            startCountdown();
            
            // 模拟发送验证码
            showToast('验证码已发送');
            console.log('模拟发送验证码到:', phoneNumber);
        }

        // 开始倒计时
        function startCountdown() {
            const sendCodeBtn = document.getElementById('sendCodeBtn');
            countdownSeconds = 60;
            sendCodeBtn.disabled = true;
            sendCodeBtn.classList.add('bg-gray-300');
            sendCodeBtn.classList.remove('bg-primary');
            
            countdownTimer = setInterval(() => {
                countdownSeconds--;
                sendCodeBtn.textContent = `重新获取(${countdownSeconds})`;
                
                if (countdownSeconds <= 0) {
                    clearInterval(countdownTimer);
                    countdownTimer = null;
                    resetSendCodeButton();
                }
            }, 1000);
        }

        // 重置发送验证码按钮
        function resetSendCodeButton() {
            const sendCodeBtn = document.getElementById('sendCodeBtn');
            sendCodeBtn.disabled = false;
            sendCodeBtn.classList.remove('bg-gray-300');
            sendCodeBtn.classList.add('bg-primary');
            sendCodeBtn.textContent = '获取验证码';
        }

        // 验证码登录
        function codeLogin() {
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            const verifyCode = document.getElementById('verifyCode').value.trim();
            
            // 简单格式检查，不做真实性验证
            if (!phoneNumber || phoneNumber.length !== 11) {
                showToast('请输入11位手机号码');
                return;
            }
            
            if (!verifyCode || verifyCode.length !== 6) {
                showToast('请输入6位验证码');
                return;
            }
            
            // 模拟验证码验证成功（不检查验证码真实性）
            handleCodeLoginSuccess(phoneNumber);
        }

        // 处理验证码登录成功
        function handleCodeLoginSuccess(phoneNumber) {
            // 保存登录信息
            const userInfo = {
                phone: phoneNumber,
                loginType: 'code',
                timestamp: Date.now()
            };
            
            const loginInfo = {
                isLoggedIn: true,
                loginTime: new Date().toISOString(),
                ...userInfo
            };
            
            localStorage.setItem('loginInfo', JSON.stringify(loginInfo));
            
            // 保存用户信息
            const userData = {
                phone: phoneNumber,
                name: '',
                gender: ''
            };
            localStorage.setItem('userInfo', JSON.stringify(userData));
            
            // 关闭弹窗
            closeCodeLogin();
            
            showToast('登录成功');
            setTimeout(() => {
                redirectAfterLogin();
            }, 1000);
        }

        // 登录成功后跳转
        function redirectAfterLogin() {
            const returnUrl = localStorage.getItem('returnUrl');
            if (returnUrl) {
                localStorage.removeItem('returnUrl');
                window.location.href = returnUrl;
            } else {
                window.location.href = 'index.html';
            }
        }

        // 显示提示
        function showToast(message, duration = 2000) {
            // 创建临时提示元素
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 z-60 bg-black bg-opacity-80 text-white px-4 py-2 rounded-lg text-sm';
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    // 添加淡出动画
                    toast.style.transition = 'opacity 0.3s ease';
                    toast.style.opacity = '0';
                    
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }
            }, duration - 300);
        }

        // 点击遮罩关闭弹窗
        document.getElementById('codeLoginModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCodeLogin();
            }
        });
    </script>
</body>
</html>
